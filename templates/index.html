<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Solver</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Sudoku Solver</h1>

        <div class="controls">
            <form action="/" method="post">
                <label for="difficulty">Generar Sudoku:</label>
                <select name="difficulty" id="difficulty">
                    <option value="facil">Fácil</option>
                    <option value="medio" {% if difficulty == 'medio' %}selected{% endif %}>Medio</option>
                    <option value="dificil">Difícil</option>
                </select>
                <button type="submit" name="action" value="generate">Generar</button>
                <button type="submit" name="action" value="solve_bnb">Resolver (Branch & Bound)</button>
                <button type="submit" name="action" value="solve_bt">Resolver (Backtracking)</button>
            </form>
        </div>

        <div class="sudoku-grid">
            {# Outer loop for rows. Use loop.index0 directly for the row_idx. #}
            {% for row in board %}
                {# Assign row_idx from the outer loop's context for use in the inner loop #}
                {% set row_idx = loop.index0 %}
                
                {# Inner loop for columns. loop.index0 here is the col_idx #}
                {% for cell_value in row %}
                    <div class="sudoku-cell
                        {# Now use the explicitly set row_idx variable #}
                        {% if row_idx % 3 == 2 and row_idx != 8 %} border-bottom-bold {% endif %}
                        {# loop.index0 is the column index for the current cell #}
                        {% if loop.index0 % 3 == 2 and loop.index0 != 8 %} border-right-bold {% endif %}">
                        {{ cell_value if cell_value != 0 else '' }}
                    </div>
                {% endfor %}
            {% endfor %}
        </div>

        {% if solution_info %}
        <div class="solution-info">
            <h2>Resultados de la Solución:</h2>
            <p><strong>Algoritmo:</strong> {{ solution_info.algorithm }}</p>
            <p><strong>Nodos Explorados:</strong> {{ solution_info.nodes_explored }}</p>
            <p><strong>Tiempo de Ejecución:</strong> {{ "%.4f"|format(solution_info.time) }} segundos</p>
        </div>
        {% elif error_message %}
        <div class="error-message">
            <p>{{ error_message }}</p>
        </div>
        {% endif %}
    </div>
</body>
</html>